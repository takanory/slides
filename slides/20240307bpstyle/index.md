```{eval-rst}
:og:image: _images/20240307bpstyle.png
:og:image:alt: Amazon Pollyã§å•é¡Œæ–‡ã‚’èª­ã¿ä¸Šã’

.. |cover| image:: images/20240307bpstyle.png
```

# **Amazon Polly** ã§<br />å•é¡Œæ–‡ã‚’èª­ã¿ä¸Šã’

Takanori Suzuki

BPStyle #158 / 2024 Mar 7

## èƒŒæ™¯

* æŸæ¡ˆä»¶ã§å­¦ç¿’æ•™æã®é›»å­åŒ–ã‚’ã‚„ã£ã¦ã„ã‚‹
* **åˆç†çš„é…æ…®** ã®ä¸€ç’°ã¨ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆèª­ã¿ä¸Šã’ã‚’å®Ÿç¾ã—ãŸã„
* å…¨ç›²ã®äººå‘ã‘ã§ã¯ãªãã€**è´è¦šå„ªä½** ã®äººå‘ã‘

### åˆç†çš„é…æ…®

> åˆç†çš„é…æ…®ã¨ã¯ã€éšœå®³è€…ã‹ã‚‰ä½•ã‚‰ã‹ã®åŠ©ã‘ã‚’æ±‚ã‚ã‚‹æ„æ€ã®è¡¨æ˜ãŒã‚ã£ãŸå ´åˆã€éåº¦ãªè² æ‹…ã«ãªã‚Šéããªã„ç¯„å›²ã§ã€ç¤¾ä¼šçš„éšœå£ã‚’å–ã‚Šé™¤ããŸã‚ã«å¿…è¦ãªä¾¿å®œã®ã“ã¨ã§ã‚ã‚‹ã€‚ 

* [åˆç†çš„é…æ…® - Wikipedia](https://ja.wikipedia.org/wiki/%E5%90%88%E7%90%86%E7%9A%84%E9%85%8D%E6%85%AE)

### è´è¦šå„ªä½

> å­ã©ã‚‚ãŸã¡ã®æƒ…å ±ã®å–ã‚Šå…¥ã‚Œæ–¹ã‚’ä¸‹è¨˜ã®3ã‚¿ã‚¤ãƒ—ã«åˆ†é¡ã—ã€â€œçŸ¥è¦šã®å„ªä½æ€§â€ã¨ã„ã†è€ƒãˆæ–¹ãŒä¸–ç•Œã«åºƒãŒã£ã¦ã„ã£ãŸã“ã¨ã«å§‹ã¾ã‚Šã¾ã™ã€‚
>
> è¦–è¦šå„ªå…ˆå‹ãƒ»è´è¦šå„ªå…ˆå‹ãƒ»é‹å‹•æ„Ÿè¦š/è§¦è¦šå„ªå…ˆå‹

* [è´è¦šå„ªä½ã‚¿ã‚¤ãƒ—ã¨ã¯ï¼Ÿè¦‹ã‚‹ã‚ˆã‚Šèãã»ã†ãŒç†è§£ã—ã‚„ã™ã„å­ã®å‹‰å¼·æ–¹æ³•ã‚’å°‚é–€å®¶ãŒè§£èª¬](https://soctama.jp/column/67272)

### ã‚„ã‚ŠãŸã„ã“ã¨

* å•é¡Œæ–‡ç­‰ã‚’èª­ã¿ä¸Šã’ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
  * è´è¦šå„ªä½ã®ç”Ÿå¾’ãŒç†è§£ã—ã‚„ã™ãã™ã‚‹
* å®Œå…¨ã«èª­ã¿ä¸Šã’ã‚‰ã‚Œãªãã¦ã‚‚ã‚ã‚‹ç¨‹åº¦ã—ã‚‡ã†ãŒãªã„

### ã¡ãªã¿ã«å…¨ç›²ã®å ´åˆ

* OSã®ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ©Ÿèƒ½ã‚’ä½¿ã†
* PCä¸Šã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹
* Webå´ã¯ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã«å¯¾å¿œã™ã‚‹
* å‚è€ƒ: [ã‚¦ã‚§ãƒ–ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å°å…¥ã‚¬ã‚¤ãƒ‰ãƒ–ãƒƒã‚¯ï½œãƒ‡ã‚¸ã‚¿ãƒ«åº](https://www.digital.go.jp/resources/introduction-to-web-accessibility-guidebook/)
* â†’ä»Šå›ã¯å¯¾è±¡å¤–

## ã‚´ãƒ¼ãƒ«

* Amazon Pollyã§ã®éŸ³å£°åˆæˆã‚’çŸ¥ã‚‹
* Pythonã§ã®å®Ÿè£…æ–¹æ³•ã‚’çŸ¥ã‚‹
* èª­ã¿ä¸Šã’ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ–¹æ³•ã‚’çŸ¥ã‚‹

## Amaozon Polly

### Amaozon Polly

* [Amazon Pollyï¼ˆæ·±å±¤å­¦ç¿’ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚­ã‚¹ãƒˆèª­ã¿ä¸Šã’ã‚µãƒ¼ãƒ“ã‚¹ï¼‰| AWS](https://aws.amazon.com/jp/polly/)
* **æ•°åã®è¨€èª** ã§é«˜å“è³ªã§è‡ªç„¶ãªäººé–“ã®å£°ã‚’å±•é–‹
* 12ãƒ¶æœˆé–“ã€ æ¯æœˆ **500ä¸‡æ–‡å­—ãŒç„¡æ–™**
* ã‚¯ãƒ©ã‚¦ãƒ‰å‹ã‚³ãƒ¼ãƒ«ã‚»ãƒ³ã‚¿ãƒ¼ã®Amazon Connectã§ã‚‚ä½¿ãˆã‚‹

### Amazon Pollyã®ãƒ‡ãƒ¢

* [ãƒ†ã‚­ã‚¹ãƒˆèª­ã¿ä¸Šã’æ©Ÿèƒ½ | Amazon Polly | ap-northeast-1](https://ap-northeast-1.console.aws.amazon.com/polly/home/SynthesizeSpeech)
* å¤šåˆ†ytakashimaã•ã‚“ã¯å¹³æˆç‹¸åˆæˆ¦ã½ã‚“ã½ã“ãŒå¥½ãï¼ˆé©å½“ï¼‰([nibu.mp3](nibu.mp3))
* Maybe ytakashima-san likes Heisei Raccoon War Ponpoko (appropriate) ([nibu-en.mp3](nibu-en.mp3))

### Pythonã‹ã‚‰Amazon Pollyã‚’å®Ÿè¡Œ

```bash
(env) $ pip install boto3
(env) $ export AWS_ACCESS_KEY_ID=AKI...
(env) $ export AWS_SECRET_ACCESS_KEY=ZoWb...
(env) $ export AWS_DEFAULT_REGION=ap-northeast-1
```

* Boto3ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
* APIã‚’ä½¿ã†ãŸã‚ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

```{revealjs-break}
```

```{literalinclude} code/polly.py
```

* [Polly - Boto3 1.34.56 documentation](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/polly.html)
* [AWSã§AIã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã£ã¦ã¿ã‚‹ã€œç¬¬3å›pollyç·¨ã€œ #Python - Qiita](https://qiita.com/AInosukey/items/cb86c1012d40747b9dda)

```{revealjs-break}
```

* mp3ãƒ•ã‚¡ã‚¤ãƒ«ãŒã§ããŸï¼ï¼ ğŸ‰
* [masashinji.mp3](masashinji.mp3)

```{literalinclude} code/polly.py
:lines: 6-9
```

## Amazon Pollyã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### è¨€èªã®å¤‰æ›´

* è¨€èªã¨éŸ³å£°ã¯`VoiceId`å¼•æ•°ã‚’å¤‰æ›´ã™ã‚‹
* [Amazon Polly ã®éŸ³å£° - Amazon Polly](https://docs.aws.amazon.com/ja_jp/polly/latest/dg/voicelist.html)
* æ—¥æœ¬èª: Mizuki, Takumi, Kazuha, Tomoko
* è‹±èª: Ivy, Salli, Joey, Justin...ãªã©

```{literalinclude} code/polly2.py
:lines: 7-8
```

* [hajimo.mp3](hajimo.mp3)

### èª­ã¿ã®æŒ‡å®š

* ğŸ£ã‚’ã€ŒãŠå¯¿å¸ã€ã¨èª­ã¾ã›ãŸã„
* `<phoneme>` ã‚¿ã‚°ã§ãƒ•ãƒªã‚¬ãƒŠã‚’æŒ‡å®š
  * [ç™ºéŸ³è¨˜å·ã‚’ä½¿ç”¨ã™ã‚‹](https://docs.aws.amazon.com/ja_jp/polly/latest/dg/supportedtags.html#phoneme-tag)
* `TextType="ssml"` å¼•æ•°ã‚’è¿½åŠ 

```{literalinclude} code/polly3.py
:lines: 6-9
```

* [hajimo-osushi.mp3](hajimo-osushi.mp3)

### SSMLã‚¿ã‚°

* **éŸ³å£°åˆæˆãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èª(SSML)** ã«å¯¾å¿œ
  * é€Ÿåº¦å¤‰æ›´ï¼ˆ`<prosody>`ï¼‰
  * ä¸€æ™‚åœæ­¢ï¼ˆ`<break>`ï¼‰
  * å¼·èª¿ï¼ˆ`<emphasis>`ï¼‰ãªã©
* [SSML ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰éŸ³å£°ã‚’ç”Ÿæˆã™ã‚‹ - Amazon Polly](https://docs.aws.amazon.com/ja_jp/polly/latest/dg/ssml.html)
* [ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ SSML ã‚¿ã‚° - Amazon Polly](https://docs.aws.amazon.com/ja_jp/polly/latest/dg/supportedtags.html#phoneme-tag)

```{revealjs-break}
```

```{literalinclude} code/polly4.py
:lines: 6, 14-19
```

* [fumi23.mp3](fumi23.mp3)
* [fumi23-ssml.mp3](fumi23-ssml.mp3)

## **Lexicon** ã§èª­ã¿ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### Lexicon

* **ç™ºéŸ³ãƒ¬ã‚­ã‚·ã‚³ãƒ³**: ãƒ•ã‚¡ã‚¤ãƒ«ã§ç™ºéŸ³ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
* `<phoneme>` ã¯å€‹åˆ¥ã€ãƒ¬ã‚­ã‚·ã‚³ãƒ³ã¯å…±é€šãƒ«ãƒ¼ãƒ«
* è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¦ä½¿ã„åˆ†ã‘ã‚‚å¯èƒ½
* [ãƒ¬ã‚­ã‚·ã‚³ãƒ³ã®ç®¡ç† - Amazon Polly](https://docs.aws.amazon.com/ja_jp/polly/latest/dg/managing-lexicons.html)

```{revealjs-break}
```

* ãƒ¬ã‚­ã‚·ã‚³ãƒ³ã®ä¾‹

```{literalinclude} code/sushi-lexicon.xml
:caption: sushi-lexicon.xml
```

```{revealjs-break}
```

* Amazon Pollyã®ç”»é¢ã§Lexionã®ãƒ‡ãƒ¢
* [ãƒ†ã‚­ã‚¹ãƒˆèª­ã¿ä¸Šã’æ©Ÿèƒ½ | Amazon Polly](https://ap-northeast-1.console.aws.amazon.com/polly/home/SynthesizeSpeech)

```
ozkã§ã™ã—ğŸ£...
```

### Pythonã‹ã‚‰Lexiconã‚’ä½¿ç”¨

* ã€Œyukieã¯å®Ÿè³ªå¤©çš‡ï¼ˆï¼‰ã€ã«Lexiconã‚’é©ç”¨ã™ã‚‹

```{literalinclude} code/tenno-lexicon.xml
:caption: tenno-lexicon.xml
```

```{revealjs-break}
```

```{literalinclude} code/polly5.py
:lines: 7-15, 20-24
```

* [yukie.mp3](yukie.mp3)
* [yukie-emperor.mp3](yukie-emperor.mp3)

## å•é¡Œæ–‡èª­ã¿ä¸Šã’ã§ã‚„ã£ãŸã“ã¨

### Lexiconã‚’ä½œæˆ

* â‘ ã€â‘¡ï¼šã¾ã‚‹ã„ã¡ã€ã¾ã‚‹ã«
* ï¼ˆï¼‰ã€”ã€•ï¼šæ‹¬å¼§
* ã€œï¼šã‹ã‚‰
* â†’ï¼šã‚„ã˜ã‚‹ã—
* ï¼‹ï¼šãƒ—ãƒ©ã‚¹
* ãƒ»ï¼šã€ (å¥ç‚¹ã¨åŒã˜ç©ºç™½ãŒå…¥ã‚‹)

### ã‚¹ãƒšãƒ¼ã‚¹ã‚’ `<break>` ã‚¿ã‚°ã«

* é¸æŠå¼ã®æ–‡ç« ã€Œã€œã€œã‚’é¸ã¹ â‘  ã»ã’ â‘¡ ãµãŒã€
* ã‚¹ãƒšãƒ¼ã‚¹éƒ¨åˆ†ã‚’ **ä¸€æ™‚åœæ­¢ã‚¿ã‚°** ã«ç½®æ›
  * `<break strength="x-strong"/>`

### ãƒ•ãƒªã‚¬ãƒŠã‚’ `<phoneme>` ã‚¿ã‚°ã«

* å•é¡Œæ–‡ã¯HTMLå½¢å¼
* ãƒ•ãƒªã‚¬ãƒŠã¯ `<ruby>` ã‚¿ã‚°ã‚’ä½¿ç”¨

```html
<ruby>å¤©çš‡<rt>ãˆã‚“ãºã‚‰ãƒ¼</rt></ruby>
â†“
<phoneme type="ruby" ph="ãˆã‚“ãºã‚‰ãƒ¼">å¤©çš‡</phoneme>
```

### è‹±èªã¨æ—¥æœ¬èªã‚’åˆ†å‰²

* `Mizuki` ç­‰æ—¥æœ¬èªéŸ³å£°ã§è‹±èªã‚’èª­ã¾ã›ã‚‹ã¨ç™ºéŸ³ãŒã‚„ã°ã„
* ã€ŒMay the Force be with you.ã€

* [force-ja.mp3](force-ja.mp3)
* [force-en.mp3](force-en.mp3)

```{revealjs-break}
```

* è‹±èªã¨æ—¥æœ¬èªã« **åˆ†å‰²*8 ã—éŸ³å£°èª­ã¿ä¸Šã’
* 1ã¤ã®mp3ã«ã¾ã¨ã‚ã‚‹
* â†’ã„ã„æ„Ÿã˜ã®éŸ³å£°ã«ãªã‚Šãã†

```{revealjs-break}
```

* æŒ‡å®šã—ãŸè¨€èªã§èª­ã¿ä¸Šã’ã‚‹é–¢æ•°

```{literalinclude} code/polly6.py
:lines: 6-14
```

```{revealjs-break}
```

* æ­£è¦è¡¨ç¾ã§æ—¥è‹±ã‚’åˆ†å‰²ã—ã¦èª­ã¿ä¸Šã’
* [yoda.mp3](yoda.mp3)

```{literalinclude} code/polly6.py
:lines: 22-32
```

## ãã®ä»–Amazon Pollyæƒ…å ±

### 2ç¨®é¡ã®éŸ³å£°

* æ¨™æº–éŸ³å£°ã¨ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«éŸ³å£°ãŒã‚ã‚‹
* ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«éŸ³å£°ã®æ–¹ãŒã‚ˆã„ã„ã„æ„Ÿã˜
* å¯¾å¿œã—ã¦ã„ã‚‹å£°ãŒç•°ãªã‚‹
* ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«éŸ³å£°ã®æ–¹ãŒãŠé«˜ã„
* [Amazon Polly ã®éŸ³å£° - Amazon Polly](https://docs.aws.amazon.com/ja_jp/polly/latest/dg/voicelist.html)

```{revealjs-break}
```

* ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ãŸå•é¡Œæ–‡ã‚’2ç¨®é¡ã®éŸ³å£°ã§ç”Ÿæˆ
* èãæ¯”ã¹ã‚‹HTMLã‚’ç”Ÿæˆã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª

![](images/question.png)

### åŒæœŸå‡¦ç†ã® *æ–‡å­—æ•°åˆ¶é™*

* `synthesize_speech()` ã§ã®éŸ³å£°åˆæˆã¯æ–‡å­—æ•°åˆ¶é™ãŒã‚ã‚‹
* é•·æ–‡ã¯ `start_speech_synthesis_task()` ã§éåŒæœŸå‡¦ç†
  * [start_speech_synthesis_task](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/polly/client/start_speech_synthesis_task.html)
* çµæœã¯S3ã«ä¿å­˜ã•ã‚Œã‚‹
* `get_speech_synthesis_task()` ã§ã‚¿ã‚¹ã‚¯ã®çŠ¶æ…‹ãŒå–ã‚Œã‚‹

### æ•°å¼èª­ã¿ä¸Šã’

* å•é¡Œæ–‡ã§ã¯mathjaxã§æ•°å¼ã‚’æç”»
* svgã«ãªã£ã¦ã„ã‚‹ãŸã‚èª­ã¿ä¸Šã’ã§ããªã„
* ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æœ€æ–°ã«ã‚ã’ã‚‹ã¨[MathML](https://developer.mozilla.org/ja/docs/Web/MathML/Authoring)ã‚‚å‡ºåŠ›ã•ã‚Œã‚‹ã£ã½ã„
  * æ•°å¼ã‚‚èª­ã¿ä¸Šã’ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã‹ã‚‚ï¼ï¼Ÿ
  
## ã¾ã¨ã‚

* Amazon Pollyã§éŸ³å£°åˆæˆã¯ç°¡å˜ã«ã§ãã‚‹
* å¤šè¨€èªã«å¯¾å¿œ
* ç´°ã‹ã„èª¿æ•´ã‚‚å¯èƒ½
* ãªã«ã‹ã«ä½¿ãˆã‚‹ã‹ã‚‚ï¼Ÿ
* {fab}`github` [sample code](https://github.com/takanory/slides/tree/master/slides/20240307bpstyle/code)

## Thank You ğŸ™

{fas}`desktop` [slides.takanory.net](https://slides.takanory.net/)

{fab}`twitter` [@takanory](https://twitter.com/takanory)
{fab}`github` [takanory](https://github.com/takanory/)
{fab}`linkedin` [takanory](https://www.linkedin.com/in/takanory/)
{fab}`untappd` [takanory](https://untappd.com/user/takanory/)

![takanory profile](/assets/images/sokidan-square.jpg)
![kuro-chan and kuri-chan](/assets/images/kurokuri.jpg)
